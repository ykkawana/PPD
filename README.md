## Installation
### Dependency
- Python 3.7
- PyTorch 1.4.0
- CUDA 10.1

See `requirements.txt` for further dependencies. Note that the file may contain unused dependencies.
Also, we use [W&B](https://wandb.ai) for logging and storing model weights.

### Setup
create `.env` file under project root as follows:
```bash
WANDB_API_KEY=<W&B API key>
WANDB_USERNAME=<W&B user name>
WANDB_ENTITY=<W&B entity name>
WANDB_PROJECT=ppd
PROJECT_ROOT=<project root path>
```
In .env file, fill in W&B API keys, W&B user name, W&B entity (usually same with the user name) and absoltue path of this directory as project root.

## Testing
### Using generated meshes
1. Download generated meshes from [here](https://drive.google.com/drive/folders/1Dd_VSnHFuFbfGctl_SQ5LkQJGmyXvU2a?usp=sharing) (32G), extract and place them under `artifacts/experiments/mesh_out/` like the following structure;
```
artifacts/experiments/mesh_out
├── pmd_eyeglasses_main_paper
│   ├── eval
│   └── mesh
│       ├── config.yaml
│       └── eyeglasses
│           ├── 0000_0000
│           │   ├── part_mesh_0.obj
│           │   ├── part_mesh_2.obj
│           │   ...
```
2. Set config path in `scripts/eval_seg.sh` accordingly.
3. Set config path in `scripts/eval_pose.sh` accordingly.

### Using pretrained model
1. Download pretrained weights from [here](https://drive.google.com/drive/folders/10LWw7C4mX1Xbx375Sg7i1R_fWHSmC_si?usp=sharing), place `*.pth` files under `weights/main-paper`.
2. Download preprocessed data from [here](https://drive.google.com/drive/folders/1l0oeai_5J_rVm-XIJOOp9Cl6f3n1QHFP?usp=sharing) (347G), extract and place them under `artifacts/dataset/shape2motion_v3/data/sample/` like the following structure;
```
artifacts/dataset/shape2motion_v3/data/sample
├── eyeglasses 
│   ├── 0000
│   │   ├── 0000
│   │   │   ├── points_values_whole_shape_sample_wise_normalize_16.npz
│   │   │   ├── points_values_whole_shape_sample_wise_normalize_32.npz
│   │   │   ...
```
3. Run `scripts/gen_mesh.sh`.
4. Run `scripts/eval_seg.sh`. Set config path accordingly by following the example.
5. Run `scripts/eval_pose.sh`. Set config path accordingly by following the example. Config file is the one generated by segmentation evaluation.

## Training
See datails `scripts/train_res16.sh` and `scripts/train_res32.sh`.
